# 正则表达式

`.` 表示要匹配除了 `换行符` 之外的任何 `单个` 字符。如果需要 `点也匹配换行符` ，可以使用 `DOTALL` 参数

`*` 表示匹配前面的子表达式任意次，包括0次。

`+` 表示匹配前面的子表达式一次或多次，不包括0次。

`?` 表示匹配前面的子表达式0次或1次。

`{}`花括号表示 前面的字符匹配 `指定的次数` 。

`[]`方括号表示匹配指定的几个字符之一。

`|`竖线表示 匹配 其中之一 。

`^`表示匹配文本的`开头`位置。

`$` 表示匹配文本的 `结尾` 位置。

```python
import re
p = re.compile(r'^\d+', re.M)
```

compile 的第二个参数 re.M ，指明了使用多行模式

`()`括号称之为 正则表达式的 组选择。

当有多个分组的时候，我们可以使用 `(?P<分组名>...)` 这样的格式，给每个分组命名。



**匹配某种类型字符类型**

\d 匹配0-9之间任意一个数字字符，等价于表达式 [0-9]

\D 匹配任意一个不是0-9之间的数字字符，等价于表达式 [^0-9]

\s 匹配任意一个空白字符，包括 空格、tab、换行符等，等价于表达式 [\t\n\r\f\v]

\S 匹配任意一个非空白字符，等价于表达式 [^ \t\n\r\f\v]

\w 匹配任意一个文字字符，包括大小写字母、数字、下划线，等价于表达式 [a-z A-Z 0-9_]

缺省情况也包括 Unicode文字字符，如果指定 ASCII 码标记，则只包括ASCII字母

\W 匹配任意一个非文字字符，等价于表达式 [^a-zA-Z0-9_]



**切割字符串**

```python
names = '关羽; 张飞, 赵云,马超, 黄忠  李逵'
```

我们发现这些名字之间， 有的是分号隔开，有的是逗号隔开，有的是空格隔开， 而且分割符号周围还有不定数量的空格

这时，可以使用正则表达式里面的 split 方法：

```python
import re

names = '关羽; 张飞, 赵云,   马超, 黄忠  李逵'

namelist = re.split(r'[;,\s]\s*', names)
print(namelist)
```

正则表达式 `[;,\s]\s*` 指定了，分割符为 分号、逗号、空格 里面的任意一种均可，并且 该符号周围可以有不定数量的空格。



**字符串替换**

- 匹配模式替换

  比如，我们需要在下面这段文本中 所有的 链接中 找到所以 `/avxxxxxx/` 这种 以 `/av` 开头，后面接一串数字， 这种模式的字符串。

  ```python
  import re
  
  names = '''
  <a href='https://www.bilibili.com/video/av66771949/?p=1' 
  <a href='https://www.bilibili.com/video/av46349552/?p=125' 
  <a href='https://www.bilibili.com/video/av90571967/?p=33' 
  '''
  
  newStr = re.sub(r'/av\d+?/', '/cn345677/' , names)
  print(newStr)
  ```

  sub 方法就是也是替换 字符串， 但是被替换的内容 用 正则表达式来表示 符合特征的所有字符串。

  比如，这里就是第一个参数 `/av\d+?/` 这个正则表达式，表示以 `/av` 开头，后面是一串数字，再以 `/` 结尾的 这种特征的字符串 ，是需要被替换的。

  第二个参数，这里 是 `'/cn345677/'` 这个字符串，表示用什么来替换。

  第三个参数是 源字符串。

  

- 指定替换函数

  刚才的例子中，我们用来替换的是一个固定的字符串 `/cn345677/`。

  如果，我们要求，替换后的内容 的是原来的数字+6， 比如 `/av66771949/` 替换为 `/av66771955/` 。

  怎么办？

  这种更加复杂的替换，我们可以把 sub的第2个参数 `指定为一个函数` ，该函数的返回值，就是用来替换的字符串。

  

```python
import re

names = '''
<a href='https://www.bilibili.com/video/av66771949/?p=1' 
<a href='https://www.bilibili.com/video/av46349552/?p=125' 
<a href='https://www.bilibili.com/video/av90571967/?p=33' 
'''

# 替换函数，参数是 Match对象
def subFunc(match):
    # Match对象 的 match[0] 返回的是整个匹配上的字符串， 
    src = match[0]
    
    # Match对象 的 match[1] 返回的是第一个group分组的内容
    number = int(match[1]) + 6
    dest = f'/av{number}/'

    print(f'{src} 替换为 {dest}')

    # 返回值就是最终替换的字符串
    return dest

newStr = re.sub(r'/av(\d+?)/', subFunc , names)
print(newStr)
```

